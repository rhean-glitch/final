;/*FB_PKG_DELIM*/

__d("LSHandleFTSIndexProtobufMessageResponse",["LSArrayGetObjectAt","LSDecryptMessageProtobufs","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSRestoreProtobufs.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][handleFTSIndexProtobufMessageResponse] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSDecryptMessageProtobufs"),a[0],a[2]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[4]=a[3].get("restore_task_source"),d[5]=a[3].get("request_id"),c.i64.neq(a[4],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[19]=new c.Map(),d[19].set("error_msg","Expected a nonempty query result"),d[19].set("code",c.i64.cast([0,3])),d[19].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[20]=c.createArray(),d[21]=(d[20].push(d[19]),d[20]),e=[void 0,d[20]],d[13]=e[0],d[14]=e[1],e):(b=a.item,d[19]=new c.Map(),d[19].set("backup_id",b.backupId),d[19].set("device_public_key_blob",b.devicePublicKeyBlob),d[19].set("device_private_key_blob",b.devicePrivateKeyBlob),d[19].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[19].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[19].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[19].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[19].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[19].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[19].set("orf_client_state_v2_blob",void 0),d[19].set("orf_v2_authority_level",void 0),d[19].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[19].set("device_id",b.deviceId),d[19].set("backup_tenancy",b.backupTenancy),d[19].set("encryption_version",b.encryptionVersion),d[19].set("revision_version",b.revisionVersion),d[19].set("initialize_restore_result",void 0),d[19].set("authority_level",b.authorityLevel),e=[d[19],void 0],d[13]=e[0],d[14]=e[1],e)})},function(e){return d[16]=new c.Map(),d[16].set("value",d[13]),d[16].set("errors",d[14]),d[17]=d[16].get("value"),d[17]!==void 0?c.sequence([function(e){return d[19]=d[17].get("backup_id"),d[20]=d[17].get("device_public_key_blob"),d[21]=d[17].get("device_private_key_blob"),d[22]=d[17].get("epoch_storage_public_key_blob"),d[23]=d[17].get("epoch_storage_private_key_blob"),d[24]=d[17].get("epoch_auth_public_key_blob"),d[25]=d[17].get("epoch_auth_private_key_blob"),d[26]=d[17].get("mailbox_root_key_blob"),d[27]=d[17].get("ocmf_client_state_blob"),d[28]=d[17].get("orf_client_state_v2_blob"),d[29]=d[17].get("orf_v2_authority_level"),d[30]=d[17].get("oblivious_validation_token_blob"),d[31]=d[17].get("device_id"),d[32]=d[17].get("backup_tenancy"),d[33]=d[17].get("encryption_version"),d[34]=d[17].get("revision_version"),d[35]=d[17].get("initialize_restore_result"),d[36]=d[17].get("authority_level"),c.i64.neq(d[31],void 0)?c.sequence([function(a){return d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[42]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[52]=(d[42].push(c.i64.cast([0,0])),d[42]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[52]=(d[42].push(c.i64.cast([0,2])),d[42]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[52]=(d[42].push(c.i64.cast([0,3])),d[42]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[52]=(d[42].push(c.i64.cast([0,4])),d[42]):0,d[47]=c.createArray(),d[48]=c.i64.of_int32(d[42].length),c.i64.gt(d[48],c.i64.cast([0,0]))?c.loopAsync(d[48],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[47].push(d[53]),d[47])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[52]=c.createArray(),d[53]=c.i64.of_int32(d[47].length),c.i64.gt(d[53],c.i64.cast([0,0]))?c.loopAsync(d[53],function(a){return d[55]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[47],d[55]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return d[58]=(d[52].push(c.i64.to_string(d[56])),d[52])}])}):c.resolve()},function(a){return d[54]=d[52].join(","),d[49]=d[54]}])},function(a){return d[47].some(function(a){return c.i64.eq(d[33],a)})?d[50]=d[33]:d[50]=void 0,c.i64.neq(d[50],void 0)?d[51]=d[50]:d[51]=void 0,d[39]=d[51]}])},function(b){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[41]=d[32]:d[41]=c.i64.cast([0,1]),d[37]=c.i64.neq(d[31],a[4])}]):c.resolve(d[37]=!1)},function(a){return d[18]=d[37]}]):c.resolve((d[19]=d[16].get("errors"),d[20]=d[16].get("errors"),d[18]=!1))},function(a){return d[6]=d[18]}]):c.resolve(d[6]=!1)},function(e){return d[6]?c.resolve(0):c.sequence([function(e){return d[2]!==void 0?c.sequence([function(e){return d[14]=a[1].get("has_more_before"),d[15]=a[1].get("has_more_after"),d[14]?(d[23]=a[1].get("next_message_timestamp_ms_before"),d[16]=d[23]):d[16]=void 0,d[15]?(d[23]=a[1].get("next_message_timestamp_ms_after"),d[17]=d[23]):d[17]=void 0,d[18]=a[1].get("has_more_before"),d[19]=a[1].get("has_more_after"),d[20]=a[3].get("request_id"),d[21]=a[3].get("reference_timestamp"),d[22]=c.createArray(),c.nativeOperation(b("LSRestoreProtobufs.nop"),a[2],d[2],d[18],d[16],d[19],d[17],!1,d[20],d[21],a[5],d[22],d[4],void 0)},function(a){return d[13]=void 0}]):c.resolve((d[3]!==void 0?(d[14]=d[3].get("error_code"),c.i64.eq(d[14],c.i64.cast([0,1]))?0:0):0,d[13]=d[3]))},function(e){return d[13]!==void 0?c.sequence([function(b){return d[14]=a[3].get("request_id"),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[22]=new c.Map(),d[22].set("error_msg","Expected a nonempty query result"),d[22].set("code",c.i64.cast([0,3])),d[22].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[23]=c.createArray(),d[24]=(d[23].push(d[22]),d[23]),e=[void 0,d[23]],d[15]=e[0],d[16]=e[1],e):(b=a.item,d[22]=new c.Map(),d[22].set("backup_id",b.backupId),d[22].set("device_public_key_blob",b.devicePublicKeyBlob),d[22].set("device_private_key_blob",b.devicePrivateKeyBlob),d[22].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[22].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[22].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[22].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[22].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[22].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[22].set("orf_client_state_v2_blob",void 0),d[22].set("orf_v2_authority_level",void 0),d[22].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[22].set("device_id",b.deviceId),d[22].set("backup_tenancy",b.backupTenancy),d[22].set("encryption_version",b.encryptionVersion),d[22].set("revision_version",b.revisionVersion),d[22].set("initialize_restore_result",void 0),d[22].set("authority_level",b.authorityLevel),e=[d[22],void 0],d[15]=e[0],d[16]=e[1],e)})},function(a){return d[18]=new c.Map(),d[18].set("value",d[15]),d[18].set("errors",d[16]),d[19]=d[18].get("value"),d[19]!==void 0?c.sequence([function(a){return d[22]=d[19].get("backup_id"),d[23]=d[19].get("device_public_key_blob"),d[24]=d[19].get("device_private_key_blob"),d[25]=d[19].get("epoch_storage_public_key_blob"),d[26]=d[19].get("epoch_storage_private_key_blob"),d[27]=d[19].get("epoch_auth_public_key_blob"),d[28]=d[19].get("epoch_auth_private_key_blob"),d[29]=d[19].get("mailbox_root_key_blob"),d[30]=d[19].get("ocmf_client_state_blob"),d[31]=d[19].get("orf_client_state_v2_blob"),d[32]=d[19].get("orf_v2_authority_level"),d[33]=d[19].get("oblivious_validation_token_blob"),d[34]=d[19].get("device_id"),d[35]=d[19].get("backup_tenancy"),d[36]=d[19].get("encryption_version"),d[37]=d[19].get("revision_version"),d[38]=d[19].get("initialize_restore_result"),d[39]=d[19].get("authority_level"),c.i64.neq(d[34],void 0)?c.sequence([function(a){return d[41]=void 0,c.i64.neq(d[41],void 0)?c.resolve(d[42]=d[41]):c.sequence([function(a){return d[45]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[55]=(d[45].push(c.i64.cast([0,0])),d[45]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[55]=(d[45].push(c.i64.cast([0,2])),d[45]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[55]=(d[45].push(c.i64.cast([0,3])),d[45]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[55]=(d[45].push(c.i64.cast([0,4])),d[45]):0,d[50]=c.createArray(),d[51]=c.i64.of_int32(d[45].length),c.i64.gt(d[51],c.i64.cast([0,0]))?c.loopAsync(d[51],function(a){return d[55]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[55]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return d[58]=(d[50].push(d[56]),d[50])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[55]=c.createArray(),d[56]=c.i64.of_int32(d[50].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.loopAsync(d[56],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[50],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=(d[55].push(c.i64.to_string(d[59])),d[55])}])}):c.resolve()},function(a){return d[57]=d[55].join(","),d[52]=d[57]}])},function(a){return d[50].some(function(a){return c.i64.eq(d[36],a)})?d[53]=d[36]:d[53]=void 0,c.i64.neq(d[53],void 0)?d[54]=d[53]:d[54]=void 0,d[42]=d[54]}])},function(a){return c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=c.i64.cast([0,0]),c.i64.neq(d[35],void 0)?d[44]=d[35]:d[44]=c.i64.cast([0,1]),d[40]=d[34]}]):c.resolve(d[40]=void 0)},function(a){return d[20]=d[40]}]):c.resolve((d[22]=d[18].get("errors"),d[23]=d[18].get("errors"),d[20]=void 0))},function(b){return d[21]=a[3].get("restore_task_source")}]):c.resolve()}])},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleFTSIndexProtobufMessageResponse] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleFTSIndexProtobufMessageResponse",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleFTSIndexProtobufMessageResponseStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);